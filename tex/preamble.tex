\documentclass[11pt,twoside]{article}      % Specifies the document class

\usepackage{mathspec} % Must load before polyglossia, otherwise "! LaTeX Error: Option clash for package fontspec."
\setprimaryfont{Linux Libertine O}
\setmainfont[Mapping=tex-text]{Linux Libertine O} % Mapping=tex-text important for conversion of -- to en dashes

\usepackage[autostyle=true,german=quotes]{csquotes}

\usepackage{geometry}
\geometry{a4paper, left=2cm, right=2cm, top=3cm, bottom=3cm}

\usepackage{siunitx}
\sisetup{
	exponent-product = \cdot,
	fraction-function = \sfrac,
	group-digits = integer,
	group-minimum-digits = 4,
	group-separator = \text{.},
	input-product = *,
	inter-unit-product ={}\cdot{},
	list-units = repeat,
	mode = text,
	multi-part-units = repeat,
	output-decimal-marker = \text{,},
	output-product = \cdot,
	qualifier-mode = subscript,
	quotient-mode = fraction,
	range-units = repeat,
	separate-uncertainty = true,
	table-figures-uncertainty = 1,
	table-figures-integer = 1,
	table-number-alignment = center-decimal-marker
}%
\DeclareSIUnit{\K}{K}
\DeclareSIUnit{\H}{H}
\DeclareSIUnit{\S}{S}
\DeclareSIUnit{\D}{D}
\DeclareSIUnit{\AP}{AP}
\DeclareSIUnit{\GP}{GP}
\DeclareSIUnit{\AsP}{AsP}
\DeclareSIUnit{\ZfP}{ZfP}
\DeclareSIUnit{\ZfPstern}{ZfP*}

\newcommand{\SIK}[1]{\SI{#1}{\K}} % Kreuzer
\newcommand{\SIH}[1]{\SI{#1}{\H}} % Heller
\newcommand{\SIS}[1]{\SI{#1}{\S}} % Silber
\newcommand{\SID}[1]{\SI{#1}{\D}} % Dukaten

\newcommand{\SIh}[1]{\SI{#1}{\hour}} % h
\newcommand{\SId}[1]{\SI{#1}{\day}} % h

\newcommand{\SIAP}[1]{\SI{#1}{\AP}} % h
\newcommand{\SIGP}[1]{\SI{#1}{\GP}} % h
\newcommand{\SILeP}[1]{\SI{#1}{\LeP}} % h
\newcommand{\SIAsP}[1]{\SI{#1}{\AsP}} % h
\newcommand{\SIZfP}[1]{\SI{#1}{\ZfP}} % h
\newcommand{\SIZfPs}[1]{\SI{#1}{\ZfPstern}} % h

\usepackage{import}
\usepackage[intoc]{nomencl}
\renewcommand{\nomname}{Abkürzungsverzeichnis}
\makenomenclature
\usepackage{titling}
\newcommand{\subtitle}[1]{%
  \posttitle{%
    \par\end{center}
    \begin{center}\large#1\end{center}
    \vskip0.5em}%
}



\usepackage{xfrac}

% % % % % % % % % % % % % % % % % % % %
% array
\usepackage{array}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{C}[1]{>{\centering\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\newcolumntype{R}[1]{>{\raggedleft\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}

\usepackage{booktabs}
\setlength\heavyrulewidth{0.25ex}

% Non-booktabs definitions, but also for tables
\setlength\arrayrulewidth{0.18ex}


\usepackage{multirow}
\usepackage{xunicode}

\usepackage{xltxtra}

% % % % % % % % % % % % % % % % % % % %
% fixme
\usepackage[footnote,nomargin,draft]{fixme}

\usepackage{graphicx}
\usepackage{tabularx}
\usepackage{ltablex}
\usepackage{caption}
\captionsetup{belowskip=12pt,aboveskip=6pt}

% % % % % % % % % % % % % % % % % % % %
% enumitem
\usepackage{enumitem}

% Needed for \renewlist

% % % % % % % % % % % % % % % % % % % %
% threeparttablex
\usepackage[referable]{threeparttablex}
\renewlist{tablenotes}{enumerate}{1}
\makeatletter
\setlist[tablenotes]{label=\tnote{\alph*},ref=\alph*,itemsep=\z@,topsep=\z@skip,partopsep=\z@skip,parsep=\z@,itemindent=\z@,labelindent=\tabcolsep,labelsep=.2em,leftmargin=*,align=left,before={\footnotesize}}
\makeatother

\usepackage{colortbl}

\usepackage[table]{xcolor} % load before gitinfo2
\definecolor{linkgreen}{rgb}{0.051,0.50,0.15}
\definecolor{uriblue}{rgb}{0.051,0.15,0.50}
\definecolor{isugrey}{rgb}{0.2,0.2,0.2}
\definecolor{digibluedark}{HTML}{0b2c80}
\definecolor{tablelightblue}{rgb}{0.902, 0.929, 1.000} % desaturated, bright version of digiblue (223, 10, 100 in HSV)

% Use color for table rules
\arrayrulecolor{digibluedark}

\usepackage{gitinfo2}

% Taken from Schr4t
\tolerance 1414
\hbadness 1414
\emergencystretch 1.5em
\hfuzz 0.3pt
\widowpenalty 10000
\vfuzz \hfuzz
\raggedbottom
% /Taken from Schr4t

% xstring: einfache Stringverarbeitung
% Zur Extraktion des Datums aus \gitAuthorIsoDate: 2016-04-25 20:35:56 +0200
% Ziel: 20160425203556
% Zeitzoneninformation wird wahrscheinlich aus der Umgebung genommen; muss
\usepackage{xstring}
\StrLeft{\gitAuthorIsoDate}{4}[\isuAuthorPDFyear]
\StrMid{\gitAuthorIsoDate}{6}{7}[\isuAuthorPDFmonth]
\StrMid{\gitAuthorIsoDate}{9}{10}[\isuAuthorPDFday]
\StrMid{\gitAuthorIsoDate}{12}{13}[\isuAuthorPDFhour]
\StrMid{\gitAuthorIsoDate}{15}{16}[\isuAuthorPDFmin]
\StrMid{\gitAuthorIsoDate}{18}{19}[\isuAuthorPDFsecond]
\StrMid{\gitAuthorIsoDate}{21}{21}[\isuAuthorPDFTZsign]
\StrMid{\gitAuthorIsoDate}{22}{23}[\isuAuthorPDFTZhour]
\StrMid{\gitAuthorIsoDate}{24}{25}[\isuAuthorPDFTZmin]
\newcommand{\isuPDFdate}{%
	\isuAuthorPDFyear%
	\isuAuthorPDFmonth%
	\isuAuthorPDFday%
	\isuAuthorPDFhour%
	\isuAuthorPDFmin%
	\isuAuthorPDFsecond%
	\isuAuthorPDFTZsign%
	\isuAuthorPDFTZhour%
	:\isuAuthorPDFTZmin%
}

% % % % % % % % % % % % % % % % % % % %
% hyphenat
\usepackage{hyphenat}

% % % % % % % % % % % % % % % % % % % %
% babel
\usepackage[main=ngerman]{babel}
\addto\extrasngerman{\sisetup{output-decimal-marker = {,}}}

% % % % % % % % % % % % % % % % % % % %
% xpatch
\usepackage{xpatch}

% % % % % % % % % % % % % % % % % % % %
% biblatex
\usepackage[sorting=none,style=alphabetic,maxcitenames=2,maxbibnames=99999,hyperref=true,backref=true,abbreviate=false,alldates=iso,seconds=true,backend=biber]{biblatex}

\DeclareFieldFormat{labelalpha}{\thefield{entrykey}}
\DeclareFieldFormat{extraalpha}{}

\xpatchbibmacro{name:andothers}{%
  \bibstring{andothers}%
}{%
  \bibstring[\textit]{andothers}%
}{}{}


\addbibresource{dsa-refs.bib}

% % % % % % % % % % % % % % % % % % % %
% varioref
\usepackage{varioref}

\addto\extrangerman{%
\renewcommand{\reftextfaceafter}{auf der gegenüberliegenden Seite}%
\renewcommand{\reftextfacebefore}{auf der gegenüberliegenden Seite}%
\renewcommand{\reftextafter}{auf der vorherigen Seite}%
\renewcommand{\reftextbefore}{auf der nächsten Seite}%
}

% % % % % % % % % % % % % % % % % % % %
% hyperref
\usepackage[]{hyperref}
\hypersetup{
	pdfborder = {0 0 1},
	pdfborderstyle = {/S/U/W 1},
	breaklinks = true,
	colorlinks = false,
	citebordercolor = linkgreen,
	linkbordercolor = linkgreen,
	urlbordercolor = uriblue,
	pdftitle = {Sucht \& Rauschmittel -- Inoffizielle Ersatzregeln zum Nachteil „Sucht“ und Hausregeln zur Beschaffung, Herstellung und dem Konsum von Drogen inklusive Nebenwirkungen für Das Schwarze Auge 4.1},
	pdfauthor = {Steven Koenig / Isurandil},
	pdfsubject = {Analyse und anschließende Überarbeitung der Regeln für Süchte und Rauschmittel in DSA4.1},
	pdfkeywords = {Version: \gitHash{}, date: \gitAuthorDate{}, branch: \gitBranch{}},
	pdfinfo={
		CreationDate={D:\isuPDFdate{}},
		ModDate={D:\isuPDFdate{}},
	}
}
\urlstyle{rm}

% % % % % % % % % % % % % % % % % % % %
% cleveref
\usepackage[noabbrev,nameinlink]{cleveref}

% Nach cleveref laden
\usepackage[bottom,hang]{footmisc}

% Redefinitions
\renewcommand{\nobreakspace}[1]{ #1}% The space used is U+00A0 NO-BREAK SPACE; This is a fix for the error "! LaTeX Error: Command \nobreakspace unavailable in encoding EU1."

\let\olditemize\itemize
\renewcommand{\itemize}{
	\olditemize
	\setlength{\topsep}{0pt}
	\setlength{\partopsep}{0pt}
	\setlength{\parskip}{0pt}
	\setlength{\itemsep}{3pt}
	\setlength{\parskip}{0pt}
	\setlength{\parsep}{0pt}
}

\renewcommand{\labelitemi}{\raisebox{0.15em}{\scalebox{1.2}{{\tiny{●}}}}}
\renewcommand{\labelitemii}{\raisebox{0.2em}{\tiny{◆}}}
\renewcommand{\labelitemiii}{\raisebox{0.15em}{\scalebox{1.4}{\tiny{▶}}}}

\let\oldenumerate\enumerate
\renewcommand{\enumerate}{
	\oldenumerate
	\setlength{\topsep}{0pt}
	\setlength{\partopsep}{0pt}
	\setlength{\parskip}{0pt}
	\setlength{\itemsep}{3pt}
	\setlength{\parskip}{0pt}
	\setlength{\parsep}{0pt}
}

% Footnote
% Einzug insgesamt
\setlength{\footnotemargin}{1.2em}
% Zeichen rechts ausgerichtet
% https://tex.stackexchange.com/a/236802
\makeatletter
\patchcmd{\@makefntext}
  {\@makefnmark\hss}
  {\hss\@makefnmark\hspace{4pt}}
  {}{}
\makeatletter

% Source: http://tex.stackexchange.com/questions/278872/pythontex-inputiffileexists-for-inputting-rows-in-longtable-creates-spurious
% No extra space after \InputIfFileExists in table
\makeatletter
\@ifundefined{filehook@csuse}
  {\let\TablesafeInputIfFileExists\InputIfFileExists}% filehook is not loaded
  {\let\TablesafeInputIfFileExists\latex@InputIfFileExists}
\makeatletter

% Eigene Counter
% Source: https://tex.stackexchange.com/a/21305
\newcounter{conseqno}
\newcommand{\conseq}[1]{\refstepcounter{conseqno}\label{#1}}
\setcounter{conseqno}{1}


% % % % % % % % % % % % % % % % % % % %
% Hyphenation list
\hyphenation{Phex-ge-weih-te Phex-ge-weih-ter Phex-ge-weih-ten}
